<!doctype html>
<html>
  <head>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCZv3QbAq3tNadvNz0_Um8i1GrnTCiMMs8&sensor=false"></script>
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 400px; width:800px; border: 1px solid red }
    </style>
  </head>
  <body>
    <h1>MapTrip</h1>
    <p>Map your trip while you're at home</p>
    <div id="map-canvas"></div>
    <script>
      function initialize() {
        $.get("/maps/barcelona").done(function(data) {  
          showMap(document.getElementById("map-canvas"),data);
	});
      }

      function showMap(element,data) {
        var locations=data.locations;
        var mapOptions = {
          center: new google.maps.LatLng(-34.397, 150.644),
          zoom: 8
        };
        var map = new google.maps.Map(element,mapOptions);
	var bounds = new google.maps.LatLngBounds();

        for (var i in locations) {
          var location=locations[i];
	  if (location.type=="point") {
            var marker=addPoint(map,location);
	    bounds.extend(marker.position);
	  }
	  if (location.type=="route") {
            var route=addRoute(map,location);
	  }
        }
	map.fitBounds(bounds);
      }

      function addPoint(map,location) {
            var marker = new google.maps.Marker({
              position: new google.maps.LatLng(location.coords[0],location.coords[1]),
              map: map,
              title: location.name
            });
	    return marker;
      }

      function addRoute(map,location) {
        var googleCoords=[];
        for (var i in location.coords) {
          var coord=location.coords[i];
          googleCoords[i]=new google.maps.LatLng(coord[0],coord[1]);
        }
        var line = new google.maps.Polyline({
          path: googleCoords,
          map: map,
          geodesic: true,
          strokeColor: '#FF0000',
          strokeOpacity: 1.0,
          strokeWeight: 2
        });
	return line;
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </body>
</html>
